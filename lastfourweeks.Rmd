---
title: Hospitals in Knoxville region
output:
  html_document:
    includes:
       in_header: GA_Script.html
---


```{r, echo=FALSE, message=FALSE, warning=FALSE}
source("_packages.R")
source("R/functions.R")
tar_load(hospital_knox)
tar_load(daily_focal)
counties_in_hospital_region <- FocalCountiesEastTN()
last_hospital_update <- max(hospital_knox$Date)
elapsed_seconds <- 28*24*60*60 # for 28 days
daily_focal$PercentActive <- 100*daily_focal$TOTAL_ACTIVE/daily_focal$Population
daily_focal$PercentDead <- 100*daily_focal$TOTAL_DEATHS/daily_focal$Population
daily_focal$PercentHospitalized <- 100*daily_focal$TOTAL_HOSPITALIZED/daily_focal$Population
daily_focal$PercentConfirmed <- 100*daily_focal$TOTAL_CONFIRMED/daily_focal$Population
daily_region <- subset(daily_focal, Region=="East TN")
```

We can focus on just the last four weeks, as some past peaks may obscure local dynamics otherwise.

Total people in the area who have active covid infections right now *and* who have reported this to the state.

```{r percentageactive, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="Percentage of people in the region with active covid-19"}

active <- ggplot(subset(daily_focal, daily_focal$DATE >= daily_focal$DATE[nrow(daily_focal)]-elapsed_seconds), aes(x=DATE, y=PercentActive, group=Region)) + geom_line(aes(colour=Region)) + ylab("Percent of people with active covid infections each day") + xlab("Date") + ylim(0,NA)  + scale_colour_viridis_d(end=0.8) + theme_light()

print(active)
```

The [Knox County Health Department](https://covid.knoxcountytn.gov) puts out information on hospital capacity in their region, which is `r paste0(sort(counties_in_hospital_region), collapse=", ")` Counties; there are 19 hospitals in this region with potential ICU beds.


```{r hospitalcapacityplot, echo=FALSE, message=FALSE, warning=FALSE}
try(hosp_plot <- ggplot(subset(hospital_knox, Date>=max(hospital_knox$Date)-elapsed_seconds), aes(x=Date, y=Current.Utilization, group=Resource)) + geom_line(aes(colour=Resource)) +  ylab("Percent Utilization in East Tennessee Region") + xlab("Date") + ylim(0,100) + theme_light() + scale_colour_viridis_d(end=0.8) + geom_hline(yintercept=100, col="red"))
try(print(hosp_plot))

```

