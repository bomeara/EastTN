---
title: Knox County Schools
output:
  html_document:
    includes:
       in_header: GA_Script.html
---

Knox County Schools are releasing information at https://www.knoxschools.org/covid, I take a snapshot of this every 24 hours and plot it. See also this page populated by parents and guardians of students as an unofficial project, which gives more granular data on individual schools: https://kcsdashboard.org/.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="Line plot of active covid cases"}

source("_packages.R")
tar_load(schools_knox)
tar_load(individual_schools_knox)
individual_schools_most_recent <- subset(individual_schools_knox, Date == max(Date))
schools_knox <- schools_knox[!is.na(schools_knox$Active_Students_Count),]

tar_load(schoolkids_daily)
schools_knox_counts <- data.frame(Date=rep(schools_knox$Date,2), Count=c(schools_knox$Active_Students_Count, schools_knox$Active_Staff_Count), Population=c(rep("Student", nrow(schools_knox)), rep("Staff", nrow(schools_knox))))

try(knox_schools_ytd <- ggplot(schools_knox_counts, aes(x=Date, y=Count, group=Population)) + geom_line(aes(colour=Population)) + theme_light() + ylab("Number of individuals with active covid infections") + xlab("Date") + ggtitle("Counts of covid infections in Knox County Schools, TN"))
print(knox_schools_ytd)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="Line plot of active covid cases now in Oak Ridge schools"}


schools_knox_percent <- data.frame(Date=rep(schools_knox$Date,2), Percent=c(schools_knox$Active_Students_Percent, schools_knox$Active_Staff_Percent), Population=c(rep("Student", nrow(schools_knox)), rep("Staff", nrow(schools_knox))))



try(knox_schools_pct <- ggplot(schools_knox_percent, aes(x=Date, y=Percent, group=Population)) + geom_line(aes(colour=Population)) + theme_light() + ylab("Percent of individuals with active covid infections") + xlab("Date") + ggtitle("Percentage of covid infections in Knox County Schools, TN"))
print(knox_schools_pct)
```

Knox County Schools now have data on individual schools. We can see the percentage of students and staff in each school (those absent could be out for many different reasons, not just covid).

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="percentage of staff and students present"}
present_plot <- ggplot(individual_schools_most_recent, aes(x=Student_Present_Percent, y=Staff_Present_Percent, group=Level, text=School)) + geom_point(aes(colour=Level)) + theme_light() + ylab("Percentage of staff present") + xlab("Percentage of students present") + ggtitle(paste0("Attendance in each school as of ", as.Date(max(individual_schools_most_recent$Date),"%b %d, %Y")))
print(present_plot)
#plotly_result <- ggplotly(present_plot, tooltip="text")
#print(plotly_result)
```

Plotting this by individual school over time, students first:

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="percentage of staff and students present"}

try(knox_schools_ytd <- ggplot(individual_schools_knox, aes(x=Date, y=Student_Present_Percent, group=School)) + geom_line(aes(colour=School)) + theme_light() + ylab("Percentage of students in attendance") + xlab("Date") + ggtitle("Student attendance in Knox County Schools") + facet_wrap(~ School, ncol=3) + theme(legend.position = "none") )
print(knox_schools_ytd)
```

And staff:

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="percentage of staff and students present"}

try(knox_schools_staff_ytd <- ggplot(individual_schools_knox, aes(x=Date, y=Staff_Present_Percent, group=School)) + geom_line(aes(colour=School)) + theme_light() + ylab("Percentage of staff in attendance") + xlab("Date") + ggtitle("Staff attendance in Knox County Schools") + facet_wrap(~ School, ncol=3) + theme(legend.position = "none") )
print(knox_schools_staff_ytd)
```

We can also compare Knox County Schools to what the state has for students age 5-17 who live in Knox County (who include the students enrolled in the public schools, but also those who go to private schools, who go out of the district, etc.). The state data includes new cases, while Knox County Schools only includes active cases, which depending on definition can be all of those who have been 10 days or 14 days since the onset of symptoms and who have a positive test result. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.alt="school vs state data"}
schoolkids_knox <- subset(schoolkids_daily, Region=="Knox County")
active_knox <- data.frame(DATE=rep(schoolkids_knox$DATE,2), ACTIVE_CASES=c(zoo::rollsum(schoolkids_knox$NEW_CASES, k=10, align="right", fill=NA), zoo::rollsum(schoolkids_knox$NEW_CASES, k=14, align="right", fill=NA)), POPULATION=c(rep("Knox County ('Active' = 10 days, age 5-17)", nrow(schoolkids_knox)), rep("Knox County ('Active' = 14 days, age 5-17)", nrow(schoolkids_knox)))) 
active_knox <- rbind(active_knox, data.frame(DATE=schools_knox$Date, ACTIVE_CASES=schools_knox$Active_Students_Count, POPULATION=rep("Knox Schools Only Data", nrow(schools_knox))))


try(knox_schools_vs_state <- ggplot(subset(active_knox, DATE>=as.Date("2021-06-01")), aes(x=DATE, y=ACTIVE_CASES, group=POPULATION)) + geom_line(aes(colour=POPULATION)) + theme_light() + ylab("Number of active covid cases for\npeople of student age in Knox County") + xlab("Date") + ggtitle("Percentage of covid infections in Knox County Schools, TN"))
print(knox_schools_vs_state)
```

I also maintain [vaccication.org](http://vaccication.org). This has information about vaccination in various US counties; below is the page for Knox County. Pay special note to the vaccination rate for those age 12-18.

<iframe src='https://vaccication.org/counties/Knox_TN.html' width="100%" height=1600></iframe>